<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HttpBehavior Demo</title>
  <link rel="icon" 
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' 
    viewBox='0 0 100 100'><text y='.9em' font-size='90'>üîê</text>
    </svg>">

  <style>
    :root {
      color-scheme: light dark;
      --error: #ff5722;
      --success: #00c853;
      --idle: #666;
      
      /* Fonts */
      --font-ui: -apple-system, system-ui, sans-serif;
      --font-mono: ui-monospace, 'SF Mono', monospace;
      
      /* Theme colors */
      --input-color: inherit;
      --input-container-color: inherit;
      --label-color: inherit;
      --url-color: inherit;
      --border-color: #eee;
    }
    
    @media (prefers-color-scheme: dark) {
      :root {
        --input-color: #ccc;
        --input-container-color: #666;
        --label-color: #999;
        --url-color: #ccc;
      }
    }

    * {
      box-sizing: border-box;
    }

    html {
      font-size: 13px;
    }

    body {
      font-family: 'New York', ui-serif, serif;
      background-color: Canvas;
      color: CanvasText;
      margin: 0;
      padding: 20px;
      line-height: 1.6;
      
      main {
        max-width: 80ch;
        margin: 0 auto;
      }

      h1, h2, h3 {
        font-weight: 200;
        letter-spacing: 0.01em;
      }
      
      h1 {
        margin-bottom: 4rem;
      }
      
      h2 {
        margin-bottom: 2rem;
      }
      
      h3 {
        font-weight: 300;
        margin: 2rem 0 1rem 0;
      }
      
      [role="button"] {
        margin: 0.5rem 0.5rem 0.5rem 0;
        background: #2196F3;
        color: white;
      }
      

      demo-element {
        display: block;
      }
      
      paper-input {
        --paper-input-container-input-color: var(--input-color);
        --paper-input-container-color: var(--input-container-color);
      }
      
      paper-input input {
        color: var(--input-color) !important;
      }
      
      paper-input label {
        color: var(--label-color) !important;
      }
      
      .label {
        color: var(--label-color);
      }
      
      .url {
        color: var(--url-color);
      }
    }

  </style>
  
  <script src="bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <link rel="import" href="bower_components/polymer/polymer.html">
  <link rel="import" href="bower_components/paper-button/paper-button.html">
  <link rel="import" href="bower_components/paper-input/paper-input.html">
  <link rel="import" href="bower_components/paper-progress/paper-progress.html">
  <script src="errors/auth.js"></script>
  <script src="http-behavior.js"></script>
  <script>
    console.log('After loading http-behavior.js, HttpBehavior is:', typeof HttpBehavior);
  </script>
</head>
<body>
  <main>
    <h1>HttpBehavior Demo</h1>
    <demo-element bapi-url="https://bapi-demo-29e490599d2e.herokuapp.com/api"></demo-element>
  </main>

<dom-module id="demo-element">
  <template>
    <style>
      :host {
        display: block;
      }
      
      section {
        border-radius: 4px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
        margin: 1rem 0;
        padding: 1rem;
      }
      
      details {
        margin: 0;
      }
      
      summary {
        font-size: 0.9rem;
        color: #666;
        cursor: pointer;
        user-select: none;
        
        details[open] & {
          margin-bottom: 0.5rem;
        }
      }
      
      paper-input {
        margin: 0.5rem 0;
      }
      
      table {
        border-collapse: collapse;
        width: 100%;
        font-size: 0.9rem;
      }
      
      td {
        padding: 0.75rem 1rem;
        border-bottom: 1px solid var(--border-color);
      }
      
      td:first-child {
        color: var(--idle);
        font-weight: 500;
      }
      
      paper-button {
        --paper-button-ink-color: white;
        color: white;
        text-transform: none;
        font-family: var(--font-ui);
        margin-top: 0.5rem;
      }
      
      paper-button[raised] {
        background: #3700b3;
      }
      
      paper-button.secondary {
        background: #b1006a;
      }
      
      paper-button[disabled] {
        background: #666 !important;
        color: #bbb !important;
        opacity: 0.5;
      }
      
      .login-status > div {
        color: var(--error);
        font-size: 0.9rem;
        margin: 0.5rem 0;
      }
      
      .progress-container {
        min-height: 12em;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2em;
      }
      
      paper-progress {
        width: 100%;
      }
      
      .status-indicator {
        display: inline-block;
        width: 14px;
        height: 14px;
        border-radius: 50%;
        margin-left: 1rem;
        margin-right: 1rem;
        box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        vertical-align: middle;
        
        &.online {
          background: var(--success);
        }
        
        &.offline {
          background: var(--error);
        }
        
        &.unknown {
          background: #757575;
        }
      }
      
      .error {
        color: var(--error);
      }
      
      .success {
        color: var(--success);
      }
      
      .idle {
        color: var(--idle);
      }
      
      /* Status badge styling */
      span {
        &.success, &.idle, &.error {
          color: white !important;
          padding: 2px 6px !important;
          border-radius: 3px !important;
          font-size: 0.85em;
          vertical-align: baseline;
        }
        
        &.success {
          background: var(--success) !important;
          font-weight: 500;
        }
        
        &.idle {
          background: var(--idle) !important;
        }
        
        &.error {
          background: var(--error) !important;
        }
      }
      
      /* Token countdown styling */
      [class^="countdown-"] {
        font-weight: bold;
        font-size: 1.1em;
        padding: 4px 8px;
        border-radius: 4px;
        
        &:not(.countdown-error) {
          font-family: var(--font-mono);
        }
      }
      
      .countdown-normal {
        color: #2196f3 !important;
        background: rgba(33, 150, 243, 0.1);
      }
      
      .countdown-warning {
        color: #ff9800 !important;
        background: rgba(255, 152, 0, 0.1);
        animation: pulse-warning 1s infinite;
      }
      
      .countdown-critical {
        color: #f44336 !important;
        background: rgba(244, 67, 54, 0.1);
        animation: pulse-critical 0.5s infinite;
      }
      
      .countdown-expired {
        color: #d32f2f !important;
        background: rgba(211, 47, 47, 0.2);
        animation: blink 1s infinite;
      }
      
      .countdown-error {
        color: #666 !important;
        font-style: italic;
        font-weight: normal;
        padding: 0;
      }
      
      @keyframes pulse-warning {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
      }
      
      @keyframes pulse-critical {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.8; transform: scale(1.05); }
      }
      
      @keyframes blink {
        0%, 50% { opacity: 1; }
        51%, 100% { opacity: 0.3; }
      }
      
      /* CSS Grid Layout */
      main.auth-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        margin: 2rem 0;
      }
      
      form {
        padding: 1.5rem;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      }
      
      section {
        &.login-status {
          padding: 1.5rem;
          border-radius: 8px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.1);
          margin-bottom: 2rem;
          
          div {
            margin: 0.5rem 0;
            font-family: var(--font-mono);
            font-size: 0.9em;
          }
        }
        
        &.status-grid {
          display: block;
          margin: 2rem 0;
        }
      }
      
      article {
        padding: 1.5rem;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      }
      
      footer {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        margin: 2rem 0;
        padding: 1rem 0;
      }
      
      
      @media (max-width: 768px) {
        main.auth-grid {
          grid-template-columns: 1fr;
        }
        
        footer {
          flex-direction: column;
        }
      }
      
    </style>
    
    <h2>Authentication Test Panel</h2>
    
    <!-- Configuration -->
    <details>
      <summary><span class$="status-indicator [[healthy]]"></span> <span class="url">{{bapiUrl}}</span></summary>
      <paper-input label="BAPI URL" value="{{bapiUrl::input}}"></paper-input>
      <paper-button raised on-click="_applyConfig">Apply</paper-button>
      <paper-button raised class="secondary" on-click="pingApi">Ping API</paper-button>
    </details>

    <!-- Login Status -->
    <section class="login-status">
      <template is="dom-if" if="[[lastError]]">
        <div>[[lastError]]</div>
      </template>
      <template is="dom-if" if="[[!loading]]">
        <table>
          <tr><td>Auth State</td><td><span class$="[[auth.status]]">[[auth.status]]</span></td></tr>
          <tr><td>User</td><td>[[view.user.name]]</td></tr>
          <tr><td>Access Token</td><td>[[view.user.accessToken]]</td></tr>
          <tr><td>Refresh Token</td><td>[[view.user.refreshToken]]</td></tr>
          <tr><td>Token Expires</td><td><span class$="[[view.user.expiryClass]]">[[view.user.tokenExpiry]]</span></td></tr>
        </table>
      </template>
    </section>

    <!-- Authentication Forms -->
    <main class="auth-grid">
      <form>
        <h3>Register</h3>
        <paper-input label="Name" value="{{regName}}"></paper-input>
        <paper-input label="Email" value="{{regEmail}}"></paper-input>
        <paper-input label="Password" type="password" value="{{regPassword}}"></paper-input>
        <paper-button raised class="secondary" on-click="_handleRegister">Register</paper-button>
      </form>

      <form>
        <h3>Login</h3>
        <paper-input label="Email" value="{{loginEmail}}"></paper-input>
        <paper-input label="Password" type="password" value="{{loginPassword}}"></paper-input>
        <paper-input style="visibility: hidden;" label="Spacer"></paper-input>
        <paper-button raised disabled$="[[isLoggedIn]]" on-click="_handleLogin">Login</paper-button>
      </form>
    </main>

    <!-- Status Display -->
    <section class="status-grid">
      <article>
        <h3>üìÑ Paper Status</h3>
        <template is="dom-if" if="[[!loading]]">
          <table>
            <tr><td>Paper Name</td><td>[[view.paper.name]]</td></tr>
            <tr><td>Paper ID</td><td>[[view.paper.id]]</td></tr>
            <tr><td>Type</td><td>[[view.paper.type]]</td></tr>
            <tr><td>Created</td><td>[[view.paper.created]]</td></tr>
            <tr><td>API Status</td><td><span class$="[[view.paper.status]]">[[view.paper.status]]</span></td></tr>
          </table>
        </template>
      </article>
    </section>

    <!-- Actions -->
    <footer>
      <paper-button raised disabled$="[[!isLoggedIn]]" on-click="_testUserApi">Get User Profile</paper-button>
      <paper-button raised disabled$="[[!isLoggedIn]]" on-click="_testPaperApi">Get Paper Data</paper-button>
      <paper-button raised disabled$="[[!isLoggedIn]]" on-click="_handleRefresh">Refresh Token</paper-button>
      <paper-button raised disabled$="[[!isLoggedIn]]" on-click="_handleLogout">Logout</paper-button>
    </footer>
  </template>
</dom-module>

  <script>
    window.addEventListener('WebComponentsReady', function() {
      console.log('HttpBehavior defined?', typeof HttpBehavior);
      console.log('HttpBehavior:', HttpBehavior);
      
      Polymer({
        is: 'demo-element',
        
        behaviors: [HttpBehavior],
        
        properties: {
          status: {
            type: String,
            value: 'Ready'
          },
          bapiUrl: {
            type: String,
            value: 'https://bapi-demo-29e490599d2e.herokuapp.com/api',
            notify: true,
            reflectToAttribute: true
          },
          loginEmail: {
            type: String,
            value: 'luv2@example.com'
          },
          loginPassword: {
            type: String,
            value: 'password123'
          },
          regName: {
            type: String,
            value: 'Alice Foo'
          },
          regEmail: {
            type: String,
            value: 'alice@example.com'
          },
          regPassword: {
            type: String,
            value: 'bazqux456'
          },
          isLoggedIn: {
            type: Boolean,
            value: false,
            notify: true
          },
          loading: {
            type: Boolean,
            value: false,
            notify: true,
            reflectToAttribute: true
          },
          lastError: {
            type: String,
            value: false,
            notify: true
          },
          apiStatus: {
            type: String,
            value: 'unknown',
            notify: true
          },
          healthy: {
            type: String,
            value: 'unknown'
          },
          status: {
            type: String,
            value: 'idle'
          },
          auth: {
            type: Object,
            value: function() {
              return {
                status: 'idle',
                loading: false
              };
            }
          },
          
          view: {
            type: Object,
            value: function() {
              return {
                user: {
                  name: 'None',
                  accessToken: 'None',
                  refreshToken: 'None',
                  tokenExpiry: 'N/A'
                },
                paper: {
                  name: 'None',
                  id: 'None',
                  type: 'None',
                  created: 'None',
                  status: 'idle'
                }
              };
            }
          }
        },
        
        observers: [
          '_loggedInUserChanged(loggedInUser)'
        ],
        
        _loggedInUserChanged: function(user) {
          console.log('loggedInUser changed:', user);
          this._updateAuthStatus();
        },
        
        ready: function() {
          console.log('Demo loaded!');
          console.warn('This should definitely show');
          console.error('And this too');
          console.log('demo-element ready with HttpBehavior');
          console.log('Element:', this);
          console.log('Has behavior methods:', !!this._initializeAuth);
          this.bapiUrl = 'https://bapi-demo-29e490599d2e.herokuapp.com/api';
          console.log('bapiUrl:', this.bapiUrl);
          
          // Ensure form values are set
          this.loginEmail = this.loginEmail || 'luv2@example.com';
          this.loginPassword = this.loginPassword || 'password123';
          this.regName = this.regName || 'Alice Foo';
          this.regEmail = this.regEmail || 'alice@example.com';
          this.regPassword = this.regPassword || 'bazqux456';
          
          console.log('Form values initialized:', {
            loginEmail: this.loginEmail,
            loginPassword: this.loginPassword,
            regName: this.regName,
            regEmail: this.regEmail,
            regPassword: this.regPassword
          });
        },
        
        attached: function() {
          // Don't clear localStorage on demo load - let HttpBehavior handle session restore
          
          // Reset auth and view objects to default state
          this.set('auth.status', 'idle');
          this.set('view.user.name', 'None');
          this.set('view.user.accessToken', 'None');
          this.set('view.user.refreshToken', 'None');
          this.set('view.user.tokenExpiry', 'N/A');
          
          // Start live token expiry updates
          this._startTokenTimer();
          
          this.set('bapiUrl', 'https://bapi-demo-29e490599d2e.herokuapp.com/api');
          this._updateApiConfig();
          this.pingApi();
          
        },
        
        _updateApiConfig: function() {
          const bapiUrl = this.bapiUrl || 'https://bapi-demo-29e490599d2e.herokuapp.com/api';
          console.log('bapiUrl in _updateApiConfig:', bapiUrl);
          
          const config = {
            env: 'development',
            actions: {
              auth: {
                login: function(credentials) {
                  return this.fetch('bapi', '/user/login/email', {
                    method: 'POST',
                    body: JSON.stringify(credentials)
                  });
                },
                register: function(userData) {
                  return this.fetch('bapi', '/user/signup', {
                    method: 'POST',
                    body: JSON.stringify(userData)
                  });
                },
                logout: function() {
                  // Just clear local tokens - no API call needed
                  const behavior = this._getBehaviorInstance();
                  behavior.set('loggedInUser', null);
                  window.localStorage.removeItem('loggedInUser');
                  behavior.fire('user-logged-out');
                  return Promise.resolve();
                },
                refresh: function() {
                  const behavior = this._getBehaviorInstance();
                  const user = behavior.loggedInUser;
                  if (!user || !user.tokens || !user.tokens.refresh) {
                    throw new Error('No refresh token available');
                  }
                  return this.fetch('bapi', '/user/refresh', {
                    method: 'POST',
                    body: JSON.stringify({
                      refreshToken: user.tokens.refresh
                    })
                  });
                }
              },
              health: {
                check: function() {
                  return this.fetch('bapi', '/status');
                }
              },
              user: {
                get: function(id) {
                  return this.fetch('bapi', '/user');
                }
              },
              paper: {
                get: function(id) {
                  return this.fetch('bapi', '/user/papers/' + id);
                }
              }
            },
            services: {
              bapi: {
                base: {
                  development: bapiUrl
                }
              }
            }
          };
          
          console.log('Setting apiConfig:', config);
          this.apiConfig = config;
          console.log('After setting, this.apiConfig:', this.apiConfig);
          console.log('this._externalConfig:', this._externalConfig);
          this._apiConfigChanged(config); // Manually trigger observer
          console.log('After observer, this._externalConfig:', this._externalConfig);
          
          this._updateAuthStatus();
        },
        
        _updateAuthStatus: function() {
          const user = this.loggedInUser;
          
          // Ensure objects exist but don't set status here
          if (!this.auth) this.auth = {};
          if (!this.view) this.view = { user: {} };
          if (!this.view.user) this.view.user = {};
          
          console.log('_updateAuthStatus - user:', user);
          console.log('_updateAuthStatus - current auth.status:', this.auth.status);
          
          if (user && user.tokens) {
            console.log('Setting authenticated state');
            this.set('isLoggedIn', true);
            console.log('About to set auth.status to success');
            this.set('auth.status', 'success');
            console.log('Just set auth.status, now it is:', this.auth.status);
            console.log('Full auth object:', JSON.stringify(this.auth));
            this.set('view.user.name', user.name || user.email || 'Bank Customer');
            this.set('view.user.accessToken', user.tokens.access ? user.tokens.access.substring(0, 20) + '...' : 'None');
            this.set('view.user.refreshToken', user.tokens.refresh ? user.tokens.refresh.substring(0, 20) + '...' : 'None');
            
            // Calculate token expiry with live countdown
            this._updateTokenExpiry();
          } else {
            console.log('Setting unauthenticated state');
            this.set('isLoggedIn', false);
            console.log('About to set auth.status to idle');
            this.set('auth.status', 'idle');
            console.log('Just set auth.status, now it is:', this.auth.status);
            console.log('Full auth object:', JSON.stringify(this.auth));
            this.set('view.user.name', 'None');
            this.set('view.user.accessToken', 'None');
            this.set('view.user.refreshToken', 'None');
            this.set('view.user.tokenExpiry', 'N/A');
          }
        },
        
        _startTokenTimer: function() {
          if (this._tokenTimer) clearInterval(this._tokenTimer);
          this._tokenTimer = setInterval(this._updateTokenExpiry.bind(this), 1000);
        },
        
        _formatCountdown: function(timeLeft) {
          if (timeLeft <= 0) return { text: 'EXPIRED', className: 'countdown-expired' };
          
          const minutes = Math.floor(timeLeft / 60000);
          const seconds = Math.floor((timeLeft % 60000) / 1000);
          const timeString = `${minutes}:${seconds.toString().padStart(2, '0')}`;
          
          let className = 'countdown-normal';
          if (timeLeft < 60000) className = 'countdown-warning'; // < 1 minute
          if (timeLeft < 30000) className = 'countdown-critical'; // < 30 seconds
          
          return { text: timeString, className: className };
        },

        _updateTokenExpiry: function() {
          const user = this.loggedInUser;
          
          if (user && user.tokens && user.tokens.access) {
            try {
              const payload = JSON.parse(atob(user.tokens.access.split('.')[1]));
              const expiry = new Date(payload.exp * 1000);
              const now = new Date();
              const timeLeft = expiry - now;
              
              const formatted = this._formatCountdown(timeLeft);
              this.set('view.user.tokenExpiry', formatted.text);
              this.set('view.user.expiryClass', formatted.className);
            } catch (e) {
              this.set('view.user.tokenExpiry', '‚ùå Invalid');
              this.set('view.user.expiryClass', 'countdown-error');
            }
          } else {
            this.set('view.user.tokenExpiry', 'N/A');
            this.set('view.user.expiryClass', '');
          }
        },
        
        _handleRegister: function() {
          console.log('Register values:', {
            regName: this.regName,
            regEmail: this.regEmail,
            regPassword: this.regPassword
          });
          
          const userData = {
            name: this.regName,
            email: this.regEmail,
            password: this.regPassword
          };
          
          console.debug('[auth]: register', {
            properties: this.snapshotProps(),
            localStorage: this.snapshotStorage(),
            url: this.bapiUrl + '/user/signup',
            body: userData
          });
          
          this.set('loading', true);
          this.set('lastError', '');
          this.set('status', 'Registering user...');
          
          this.api(this).auth.register(userData)
            .then(function(response) {
              this.set('loading', false);
              this.set('status', 'Registration successful');
            }.bind(this))
            .catch(function(error) {
              this.set('loading', false);
              this.set('lastError', error.message);
              this.set('status', 'Registration error: ' + error.message);
            }.bind(this));
        },
        
        _applyConfig: function() {
          this._updateApiConfig();
          this.set('status', 'Configuration applied');
        },
        
        pingApi: function() {
          console.debug('[api]: ping', {
            properties: this.snapshotProps(),
            localStorage: this.snapshotStorage(),
            url: this.bapiUrl + '/health'
          });
          
          this.set('apiStatus', 'unknown');
          this.set('healthy', 'unknown');
          
          this.api(this).health.check()
            .then(function(response) {
              this.set('apiStatus', 'online');
          this.set('healthy', 'online');
              console.debug('[api]: ping successful', { response });
            }.bind(this))
            .catch(function(error) {
              this.set('apiStatus', 'offline');
              this.set('healthy', 'offline');
              console.debug('[api]: ping failed', { error });
            }.bind(this));
        },
        
        snapshotProps: function() {
          return Object.keys(this.properties).reduce((acc, prop) => {
            acc[prop] = this[prop];
            return acc;
          }, {});
        },
        
        snapshotStorage: function() {
          const storage = {};
          for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            storage[key] = localStorage.getItem(key);
          }
          return storage;
        },
        
        _handleLogin: function() {
          const credentials = {
            email: this.loginEmail,
            password: this.loginPassword
          };
          
          console.log('Login values:', {
            loginEmail: this.loginEmail,
            loginPassword: this.loginPassword
          });
          
          console.debug('[auth]: login', {
            properties: this.snapshotProps(),
            localStorage: this.snapshotStorage(),
            url: this.bapiUrl + '/user/login/email',
            body: credentials
          });
          
          this.set('loading', true);
          this.set('lastError', '');
          this.set('status', 'Logging in to BAPI...');
          
          this.api(this).auth.login(credentials)
            .then(function(response) {
              console.log('Login response:', response);
              this.set('loading', false);
              this.set('status', 'Login successful');
              this._updateAuthStatus();
            }.bind(this))
            .catch(function(error) {
              console.error('Login error:', error);
              this.set('loading', false);
              this.set('lastError', error.message);
              this.set('status', 'Login error: ' + error.message);
            }.bind(this));
        },
        
        _handleRefresh: function() {
          if (!this.loggedInUser) {
            this.set('status', 'Error: Not logged in');
            return;
          }
          
          console.log('Current loggedInUser for refresh:', this.loggedInUser);
          console.log('User tokens:', this.loggedInUser.tokens);
          console.log('Refresh token specifically:', this.loggedInUser.tokens ? this.loggedInUser.tokens.refresh : 'No tokens object');
          
          this.set('status', 'Refreshing token...');
          
          this.api(this).auth.refresh()
            .then(function(response) {
              this.set('status', 'Token refreshed');
              this._updateAuthStatus();
              console.log('BAPI token refresh successful:', response);
            }.bind(this))
            .catch(function(error) {
              this.set('status', 'Refresh error: ' + error.message);
              console.error('BAPI refresh error:', error);
            }.bind(this));
        },
        
        _handleLogout: function() {
          this.set('status', 'Logging out...');
          
          this.api(this).auth.logout()
            .then(function(response) {
              this.set('status', 'Logged out');
              // Force update auth status after logout
              setTimeout(() => {
                this._updateAuthStatus();
              }, 50);
              console.log('Logout successful:', response);
            }.bind(this))
            .catch(function(error) {
              this.set('status', 'Logout error: ' + error.message);
              console.error('Logout error:', error);
            }.bind(this));
        },
        
        _testUserApi: function() {
          this.set('status', 'Getting user profile...');
          
          this.api(this).user.get(1)
            .then(function(response) {
              this.set('status', 'User: ' + response.name + ' (' + response.email + ')');
            }.bind(this))
            .catch(function(error) {
              this.set('status', 'User API Error: ' + error.message);
            }.bind(this));
        },
        
        _testPaperApi: function() {
          console.log('wow')
          this.set('status', 'Getting paper data...');
          this.set('lastError', '');
          this.set('view.paper.status', 'loading');
          
          this.api(this).paper.get('1a5f0f3f-c081-4580-913a-40e01d8c9a58')
            .then(function(response) {
              console.log('Setting paper data...');
              this.set('status', 'Paper data loaded successfully');
              this.set('lastError', '');
              
              // Ensure view.paper object exists
              if (!this.view.paper) {
                this.set('view.paper', {});
              }
              
              this.set('view.paper.name', response.name || 'Untitled');
              this.set('view.paper.id', response.id || 'Unknown');
              this.set('view.paper.type', response.type || 'Unknown');
              this.set('view.paper.created', response.created_at ? new Date(response.created_at).toLocaleDateString() : 'Unknown');
              this.set('view.paper.status', 'success');
              console.log('Paper data set:', this.view.paper);
            }.bind(this))
            .catch(function(error) {
              this.set('status', 'Paper API request completed');
              this.set('lastError', error.message);
              this.set('view.paper.name', 'Error loading');
              this.set('view.paper.id', 'N/A');
              this.set('view.paper.type', 'N/A');
              this.set('view.paper.created', 'N/A');
              this.set('view.paper.status', 'error');
            }.bind(this));
        }
      });
    });
  </script>
</body>
</html>
